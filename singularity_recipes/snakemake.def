Bootstrap: docker
From: conda/miniconda3

%help
    The snakemake workflow manager.  

%post
    apt-get -y update 
    apt-get -y upgrade

    . /usr/local/etc/profile.d/conda.sh
    conda install -n base -c conda-forge mamba
    conda create -y --name python38 python=3.8 
    
    /usr/local/envs/python38/bin/python -m pip install --upgrade pip 
    /usr/local/envs/python38/bin/python -m pip install wheel snakemake

%environment
    # Automatically "conda init" so that environments can be activated
    . /usr/local/etc/profile.d/conda.sh
    conda activate python38
    snakemake --bash-completion

%test
    conda --version
    snakemake --version
    dot -V

%runscript
    snakemake $*

%apprun dryrun
    snakemake --dry-run



### Simple app
%apphelp simple
    Run the pipeline with default working arguments.

%apprun simple
    snakemake --cores 1 --use-conda $*


### Rulegraph app
%apphelp rulegraph
    Uses Snakemake and Graphviz to render the rule graph DAG to an SVG

%appinstall rulegraph
    apt-get install -y graphviz

%apprun rulegraph
    snakemake --rulegraph | dot -Tsvg
    

